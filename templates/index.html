<!doctype <!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Link Doorman</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/logo-108.png') }}?v=2">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/logo-108.png') }}?v=2">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename='css/login.css') }}" />
</head>

<body>
    {% if current_user.is_authenticated %}
    <div class="login-page">
        <div class="header">
            <h1 class="text-white">Your Settings</h1>
            <span class="text-white">Hello, {{ current_user.data['name'] }} [{{ current_user.data['email'] }}]</span>
        </div>

        {% if error %}
        <div class="red-panel">
            <span>{{ error.message }}</span>
        </div>
        {% endif %}

        <div class="form">
            {% if error %}
                <img src="{{ url_for('static', filename='img/red-tie-logo-500.png') }}" alt="logo" width="50%"> 
            {% else %}
                <img src="{{ url_for('static', filename='img/logo-500.png') }}" alt="logo" width="50%"> 
            {% endif %}
            <br>
            <form class="login-form" method="post" action="/update">
                    {% if 'yolo_endpoint' in current_user.data %}
                        <span class="muted-message">&#128077; Linked YOLO API ({{current_user.data['yolo_endpoint']['elapsed']}}s)</span>
                    {% endif %}
                    <input name="yolo_endpoint" type="url" placeholder="Public YOLO Detection API URL http://<ip>:<port>/detect" required 
                        value="{{ current_user.data.get('yolo_endpoint', {}).get('url') or form.get('yolo_endpoint', '') }}"/>

                    {% if 'client_endpoint' in current_user.data %}
                        <span class="muted-message">&#128077; Linked Client API ({{current_user.data['client_endpoint']['elapsed']}}s)</span>
                    {% endif %}
                    <input name="client_endpoint" type="url" placeholder="Public Streaming Client URL http://<ip>:<port>" required 
                        value="{{ current_user.data.get('client_endpoint', {}).get('url') or form.get('client_endpoint', '')  }}"/> 
                <button>update</button>
            </form>
            <a href="/logout" class="btn">Logout</a>
        </div>
    </div>
    {% else %}
    <div class="login-page">
        {% if error %}
        <div class="red-panel">
            <span>{{ error.message }}</span>
        </div>
        {% endif %}

        <div class="form">
            {% if error %}
            <img src="{{ url_for('static', filename='img/red-tie-logo-500.png') }}" alt="logo" width="50%"> {% else %}
            <img src="{{ url_for('static', filename='img/logo-500.png') }}" alt="logo" width="50%"> {% endif %}
            <form class="login-form">
                <a href="#" id="LoginWithAmazon">
                    <img border="0" alt="Login with Amazon" src="https://images-na.ssl-images-amazon.com/images/G/01/lwa/btnLWA_gold_156x32.png" width="156" height="32" />
                </a>
            </form>
        </div>
    </div>

    <script type="text/javascript">
        var site = 'http://' + window.location.host + '/login';
        console.log(site);
        document.getElementById('LoginWithAmazon').onclick = function() {
            options = {
                scope: 'profile',
                popup: false
            };
            amazon.Login.authorize(options, site);
            return false;
        };
    </script>

    <div id="amazon-root"></div>
    <script type="text/javascript">
        window.onAmazonLoginReady = function() {
            amazon.Login.setClientId('{{ client_id }}');
        };
        (function(d) {
            var a = d.createElement('script');
            a.type = 'text/javascript';
            a.async = true;
            a.id = 'amazon-login-sdk';
            a.src = 'https://api-cdn.amazon.com/sdk/login1.js';
            d.getElementById('amazon-root').appendChild(a);
        })(document);
    </script>
    {% endif %}


</body>

</html>